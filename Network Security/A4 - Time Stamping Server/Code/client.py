from utils import *

PR_CLIENT = 229884926492101657103968712245963847367125877851794892082981674284403904318804467280078048675010170221109019360116604896700169113167940863231107831989165293203292852813721872484976257574857040342851761954572478704093060290466387172212084850127078087792686877430186138424342033387993258980112438646902664328666978604677887330123253367172159755377381152106998068226208883099748536888056484261735371340859246387396097171746357972832721022637582804601782111842435877327889215085742015756445115614034446973645778534335899009901218714447673505455508569128798840133213004748943042430715098270249615719069179557342690965087127639444335856130863320028386647283036089025180138144969131538230157812301849971609913635599201243220497959547406009175830205128860044151263171207012488498111136988106871599881926387616773095544885366262310189811547588273728296515979994465718934974400109180511935147440426453749978693542466654756878102478028463905453139036658705426843491838729519824045724588594280211722697873584604380251612110252608354234825078688719643289339733094565497149926260304832275139904394889727863848576207598363554552835180793948888899546474864904966317298081931604717141413398801607200299136447531640114031006279407613020382723958219783989713001878741402149848940919806596754658682364357436349755602052441222646702210775776359533692539692048207778450957359202382546079155525590466839303152765956916313010015531365033394143174062161919890456687416365351023943320601723562447826593668037874073886091863397504013801222850826443751115103548634840396791188421141355572105320725072530279134611881350016186949969196245015586414026908022864603115936762033160614743650920783030499836255322891843998362050536026853465054124424907847455582521249945836686806597384477044399780978735395185656224108574039689539513003722579576152763626791676930615034582755319386820990261749583858145842408229066587564853731342872517824476130244284341316171449616577065892081074236523236227072816560246995497175426764653024721199603599447492375728589751


def send(doc):
    udp_socket = udp_client()
    send_message(udp_socket, doc, SERVER_PORT)

    response = udp_socket.recvfrom(SERVER_PORT)
    response = response[0].decode()

    return response


def verify_integrity(response):
    tokens = response.split(SEPERATOR)
    document, timestamp, signature = tokens

    print("\nDocument -\n-----------\n%s"%document)
    print("-----------\n")
    print("Timestamp:", timestamp)
    # print("Encrypted Signature:", signature)

    decrypted_sign = decrypt_text(signature, PU_SERVER)
    print("Decrypted sign:", decrypted_sign)

    concat = document + SEPERATOR + timestamp
    generated_sign = hash_function(concat)
    print("Generated Sign:", generated_sign)

    return generated_sign == decrypted_sign


def main():
    filePath = input("Drag&Drop Document here - ")
    f= open(filePath, 'r')
    doc = f.read()
    f.close()
    # doc = "Hello World"

    response = send(doc)

    if verify_integrity(response):
        print("Match\n")
    else:
        print("Altered\n")


if __name__ == '__main__':
    main()
