from utils import *

PR_SERVER = 1506310431148292064395603819798888895394682440773386162949748990928330889540388713913972809309668964839374002980844127644454330754646653770335630599563765761304974592008927947925106906680607784059425498519260321816232969396422560489133662322751259780512251606420744924243903798254131796511235092224269702764103214823065656546079643048170377683104130867184577110379636835550273436397368501969519010372015161247396310549635846872787648363069342638580133779504329249986444125611819180209687114315272910634967728974970188095742905998968284643485584928800386355341858382944302608140427354472964672978993900619855445194463436195789393935490849970661378052264499119391316424501532158938919439234789259977624640683614396164887291502954815606031759284435569849438233116421746309570783010965042152201232018235828711187366856391934833712860783805774447479601540612672576647147174932296855743020845438752969061942885936301371882809387291280976895331283059455370940124664709081994611038740261170642293423162350546167190985229329750979593092586754799108380043360655464144639957558351291670141140218427344867122551891119267463867601623678466268639557168647994339102593246258739638017907658334720389934028899342916620672516258451359626489006488507661870208886794027789118513535060397284406725561281740651480707037336568798571362488692557667899173971261801913863019559044346906004784599008023007971532668474667602299062996828826503769439500354377714662934986216086147742172001733281798366596429949423454388338976562612397515437220108254903412362666348490080119705542691655683134706339471665398275657727062970635834227038421228195522128051121206508350175596826257901821203986748583811437756696894372879032222907463002595245230169901131576007909427848154724454898490782638623225847522390979812223950791615802445180519226146642644979808828151832848079419915479661922845021589520896688320522744752437243462604357007900456810513353804710069501067703018446710294669169101799169116852455756060749940754185107527466037960061962327427137381289121


def sign(document):
    timestamp = get_datetime()
    concat = document + SEPERATOR + timestamp
    signature = hash_function(concat)

    print("\nDocument Received -\n-----------\n%s"%document)
    print("-----------\n")
    print("Timestamp:", timestamp)
    print("Signature:", signature)

    signature = apply_rsa(signature, PR_SERVER)
    document = concat + SEPERATOR + signature

    return document


def main():
    server_socket = setup_server(SERVER_PORT)
    while True:
        document, address = listen(server_socket)
        response = sign(document).encode()
        server_socket.sendto(response, address)


if __name__ == '__main__':
    main()
